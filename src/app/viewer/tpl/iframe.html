<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="always" name="referrer">
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="telephone=no" name="format-detection"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <title>百泰文化</title>
    <link rel="stylesheet" href="//assets.geilicdn.com/??v-components/cdn/0.0.4/commoncss/normalize.min.css,v-components/cdn/0.0.4/commoncss/common.min.css"/>
    <style type="text/css">
        body, .wrapper {
            background: no-repeat center top;
        }
        .wrapper {
            min-height: 100%;
        }
        body{
            width: 750px;
            overflow-x:hidden;
            zoom:0.5;
        }

        a{
            display: inline-block;
        }
    </style>
    <script src="//imgcow.oss-cn-hangzhou.aliyuncs.com/prod/baitai-components/home/ejs.min.js"></script>
    <script src="//oss.ltcdn.cc/game/Js/zepto.min.js"></script>
    <script>
        !function(e,i){var t=e.documentElement,n=navigator.userAgent.match(/iphone|ipod|ipad/gi),a=n?Math.min(i.devicePixelRatio,3):1,m="orientationchange"in window?"orientationchange":"resize";t.dataset.dpr=a;for(var d,l,c=!1,o=e.getElementsByTagName("meta"),r=0;r<o.length;r++)l=o[r],"viewport"==l.name&&(c=!0,d=l);if(c)d.content="width=device-width,initial-scale=1.0,maximum-scale=1.0, minimum-scale=1.0,user-scalable=no";else{var o=e.createElement("meta");o.name="viewport",o.content="width=device-width,initial-scale=1.0,maximum-scale=1.0, minimum-scale=1.0,user-scalable=no",t.firstElementChild.appendChild(o)}var s=function(){var e=t.clientWidth;e/a>640&&(e=640*a),window.remScale=e/640,t.style.fontSize=100*(e/750)+"px";window.FootfontSize=100*(e/750);};s(),e.addEventListener&&i.addEventListener(m,s,!1)}(document,window);
    </script>
    <script>

        var getQueryString = function(name){
            var queryJson = {};
            var search = window.location.search;
            search = search.replace(/^\?/,'');
            var fields = search.split('&');
            fields && fields.forEach(function(field){
                var arr = field.split('=');
                queryJson[arr[0]] = arr[1];
            });

            return queryJson[name] || '';
        };

        window.Gdata = {};
        window.Build = {
            render:function(){
                var html='';
                Gdata.components.forEach(function(component,order){
                    var newHtml=ejs.render(component.tpl,{items:component.items});
                    html += ('<div class="J_editer" data-component="'+encodeURIComponent(JSON.stringify(component))+'" data-order="'+order+'" style="margin-top: '+component.base.marginTop+'px;">'+newHtml+'</div>');
                });
                html = html.replace(/(\d+)px/g,function($0,$1){
                    return Number($1)/100+'rem'
                });
                document.querySelector('.wrapper').innerHTML = html;
            },

            renderGlobalConfig:function(){
                var globalConfig = Gdata.globalConfig;
                document.title = globalConfig.title;
                globalConfig.bgColor && (document.body.style['background-color'] = globalConfig.bgColor);
                globalConfig.bgImg && (document.querySelector('.wrapper').style['background-image'] = 'url('+globalConfig.bgImg+')');
            },
            update:function(data){
                Gdata = data;
                this.render();
                this.renderGlobalConfig();
            }
        };

        //如果不是非编辑模式
        if(!/isediter/i.test(window.location.href)){
            $(function(){
                Build.update(Gdata);

                $.ajax({
                    url:'//192.168.10.120/api/1.0/h5/collection/page/data',
                    dataType:'jsonp',
                    data:{
                        pageId:3,
                        token:'sdfsdf',
                        tongdunTokenId:'sdfsdfsdf',
                        back:decodeURIComponent(getQueryString('back'))
                    },
                    success:function(res){
                        var components = res.data.components;
                        for(var i=0;i<components.length;i++){
                            Gdata.components[i].items.forEach(function(item,key){
                                $.extend(Gdata.components[i].items[key],components[i].items[key])
                            })
                        }
                        Build.update(Gdata);
                    }
                });
                $('.J_editer').click(function(){

                })
            })
        }

    </script>

</head>
<body style="width: 750px;">
<div class="wrapper"></div>
</body>
</html>
